(window.webpackJsonp=window.webpackJsonp||[]).push([[215],{645:function(e,t,n){"use strict";n.r(t);var a=n(34),i=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"safepoint"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#safepoint"}},[e._v("#")]),e._v(" safepoint")]),e._v(" "),n("p",[e._v("safepoint运行机制")]),e._v(" "),n("h2",{attrs:{id:"safepoint运行机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#safepoint运行机制"}},[e._v("#")]),e._v(" safepoint运行机制")]),e._v(" "),n("p",[e._v("SafepointSynchronzie::begin\n让所有的线程进入safepoint，并且暂停这些线程的运行。")]),e._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("Universe::heap()->safepoint_synchronize_begin();\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[n("code",[e._v("safepoint_synchronize_begin")]),e._v("调用到"),n("code",[e._v("SuspendibleThreadSet::synchronize()")]),e._v("\n当前vm线程等待进入synchronized的条件发生")]),e._v(" "),n("p",[e._v("开始让系统进入safepoint，根据Java现场的运行状态不同有不同的处理。")]),e._v(" "),n("ol",[n("li",[e._v("正在解释器执行: 解释器的转发表(interpreter dispatch table)转变为每个bytecode字节码指令之间都检查safepoint condition")]),e._v(" "),n("li",[e._v("运行native code: 在从native code返回的时候，Java thread必须检查safepoint状态查看是否要block。")]),e._v(" "),n("li",[e._v("运行JIT编译后的代码：compiled code会读取全局page（Safepoint Polling)，在需要safepoint时，会设置成fault。设置polling page不可读产生page fault。")]),e._v(" "),n("li",[e._v("Blocked，线程被阻塞：在safepoint操作完成之前，线程都不能从阻塞状态恢复。")]),e._v(" "),n("li",[e._v("In VM or Transitioning between states: Java线程在状态转换，safepoint代码会等待线程在尝试转换到新状态的时候阻塞它自己")])]),e._v(" "),n("ul",[n("li",[e._v("线程会在特定时机检查safepoint flag，不能太频繁（影响性能）也不能太不频繁（可能导致safepoint进入太慢）")]),e._v(" "),n("li",[e._v("interpreter模式下:每两个bytecode指令之间都有一个检查")]),e._v(" "),n("li",[e._v("C1/C2 编译后的代码: method entry/exit")]),e._v(" "),n("li",[e._v('C1/C2 编译后的代码: "non-counted" loop的回边检查，non-counter指循环次数是未知的循环比如while(condition())。回边是一次循环完成进入下一次循环时。')])])])}),[],!1,null,null,null);t.default=i.exports}}]);