(window.webpackJsonp=window.webpackJsonp||[]).push([[154],{585:function(a,s,t){"use strict";t.r(s);var r=t(34),e=Object(r.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"javassist"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#javassist"}},[a._v("#")]),a._v(" javassist")]),a._v(" "),t("h2",{attrs:{id:"介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[a._v("#")]),a._v(" 介绍")]),a._v(" "),t("p",[a._v("javassist是一种常用的字节码操作工具，字节码操作指的是读取、分析、修改字节码等功能，常用于tracing框架、在线诊断、热更新等javaagent场景，\n关于javaagent可以参考我的另一个javaagent文章。\njavassist相对于ASM、bytebuddy有自己独特的优势。\nASM使用起来偏底层，使用时需要对jvm字节码指令比较了解，并且要使用门槛比较高的visitor模式来读取和修改字节码。\nbytebuddy的难点是API较多使用起来难度也比较大。")]),a._v(" "),t("p",[a._v("而javassist在读取、写入class字节码都能使用和反射类似的方式来实现，并且还能通过传入Java源代码来修改字节码，开发者的学习和使用门槛都比较低。")]),a._v(" "),t("h2",{attrs:{id:"使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[a._v("#")]),a._v(" 使用")]),a._v(" "),t("p",[a._v("大部分的字节码操作都是在javaagent中使用，通过Instrumentation添加我们自定义的ClassFileTransformer，ClassFileTransformer中\n读取class的bytes字节码数组，进行读取、修改，返回修改后的字节码。")]),a._v(" "),t("h3",{attrs:{id:"核心概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#核心概念"}},[a._v("#")]),a._v(" 核心概念")]),a._v(" "),t("p",[a._v("CtClass\nClassPool")]),a._v(" "),t("p",[a._v("classloader")]),a._v(" "),t("h3",{attrs:{id:"解析字节码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解析字节码"}},[a._v("#")]),a._v(" 解析字节码")]),a._v(" "),t("h4",{attrs:{id:"通过byte数组解析字节码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过byte数组解析字节码"}},[a._v("#")]),a._v(" 通过byte数组解析字节码")]),a._v(" "),t("h3",{attrs:{id:"创建新的class"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建新的class"}},[a._v("#")]),a._v(" 创建新的class")]),a._v(" "),t("h3",{attrs:{id:"修改字节码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改字节码"}},[a._v("#")]),a._v(" 修改字节码")]),a._v(" "),t("h3",{attrs:{id:""}},[t("a",{staticClass:"header-anchor",attrs:{href:"#"}},[a._v("#")])]),a._v(" "),t("p",[a._v("实现一个dump class的功能")]),a._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")])])}),[],!1,null,null,null);s.default=e.exports}}]);