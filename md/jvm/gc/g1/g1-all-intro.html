<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>G1 GC核心原理介绍 | bytejava Java进阶手册</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <script charset="utf-8" async="async" src="/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/js/global.js"></script>
    <script charset="utf-8" async="async" src="/js/fingerprint2.min.js"></script>
    <script charset="utf-8" async="async" src="https://s9.cnzz.com/z_stat.php?id=12782949&amp;web_id=1272949"></script>
    <script>
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?fa0fbf0fef3bba94118b912a64766cee";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            </script>
    <meta name="description" content="包含: Java 基础，高并发缓存，JVM，中间件，字节码编程...">
    <meta property="og:title" content="G1 GC核心原理介绍">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/md/jvm/gc/g1/g1-all-intro.html">
    <meta name="twitter:title" content="G1 GC核心原理介绍">
    <meta name="twitter:url" content="/md/jvm/gc/g1/g1-all-intro.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="robots" content="all">
    <meta name="author" content="bytejava">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="keywords" content="bytejava 高级Java，Java设计模式, 字节码编程, 中间件, Spring, Java基础, 面经手册">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.8fb5e8ac.css" as="style"><link rel="preload" href="/assets/css/styles.css?v=1729221831211" as="style"><link rel="preload" href="/assets/js/cg-styles.js?v=1729221831211" as="script"><link rel="preload" href="/assets/js/cg-app.js?v=1729221831211" as="script"><link rel="preload" href="/assets/js/cg-4.js?v=1729221831211" as="script"><link rel="preload" href="/assets/js/cg-3.js?v=1729221831211" as="script"><link rel="preload" href="/assets/js/cg-162.js?v=1729221831211" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8fb5e8ac.css"><link rel="stylesheet" href="/assets/css/styles.css?v=1729221831211">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">bytejava Java进阶手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/basic/java线程池.html" class="nav-link">
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/md/java/compiler/javac.html" class="nav-link">
  Java编译器
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JVM" class="dropdown-title"><span class="title">JVM</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/jvm/bytecode/class字节码文件格式.html" class="nav-link">
  字节码
</a></li><li class="dropdown-item"><!----> <a href="/md/jvm/jvm/javaagent.html" class="nav-link">
  jvm
</a></li><li class="dropdown-item"><!----> <a href="/md/jvm/jvmti/jvmti介绍和开发.html" class="nav-link">
  jvmti
</a></li><li class="dropdown-item"><!----> <a href="/md/jvm/gc/g1/g1-all-intro.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  G1 GC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存" class="dropdown-title"><span class="title">缓存</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/cache/redis/redis.html" class="nav-link">
  零基础到高并发应用专家，深入理解redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><span class="title">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/springboot启动请求处理过程.html" class="nav-link">
  Spring实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Kafka" class="dropdown-title"><span class="title">Kafka</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/kafka/kafka.html" class="nav-link">
  kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MyBatis" class="dropdown-title"><span class="title">MyBatis</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/mybatis/mybatis-use-general.html" class="nav-link">
  MyBatis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="业务开发" class="dropdown-title"><span class="title">业务开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/develop/" class="nav-link">
  业务开发
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/distribute/raft.html" class="nav-link">
  raft
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/algorithm/leetcode.html" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软技能通用技能" class="dropdown-title"><span class="title">软技能通用技能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/soft/晋升答辩.html" class="nav-link">
  晋升答辩
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><span class="title">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/column/column.html" class="nav-link">
  订阅我的专栏
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/liuzhengyang" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/basic/java线程池.html" class="nav-link">
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/md/java/compiler/javac.html" class="nav-link">
  Java编译器
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JVM" class="dropdown-title"><span class="title">JVM</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/jvm/bytecode/class字节码文件格式.html" class="nav-link">
  字节码
</a></li><li class="dropdown-item"><!----> <a href="/md/jvm/jvm/javaagent.html" class="nav-link">
  jvm
</a></li><li class="dropdown-item"><!----> <a href="/md/jvm/jvmti/jvmti介绍和开发.html" class="nav-link">
  jvmti
</a></li><li class="dropdown-item"><!----> <a href="/md/jvm/gc/g1/g1-all-intro.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  G1 GC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存" class="dropdown-title"><span class="title">缓存</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/cache/redis/redis.html" class="nav-link">
  零基础到高并发应用专家，深入理解redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><span class="title">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/springboot启动请求处理过程.html" class="nav-link">
  Spring实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Kafka" class="dropdown-title"><span class="title">Kafka</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/kafka/kafka.html" class="nav-link">
  kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MyBatis" class="dropdown-title"><span class="title">MyBatis</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/mybatis/mybatis-use-general.html" class="nav-link">
  MyBatis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="业务开发" class="dropdown-title"><span class="title">业务开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/develop/" class="nav-link">
  业务开发
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/distribute/raft.html" class="nav-link">
  raft
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/algorithm/leetcode.html" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软技能通用技能" class="dropdown-title"><span class="title">软技能通用技能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/soft/晋升答辩.html" class="nav-link">
  晋升答辩
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><span class="title">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/column/column.html" class="nav-link">
  订阅我的专栏
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/liuzhengyang" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>G1 GC</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/jvm/gc/g1/g1-all-intro.html" aria-current="page" class="active sidebar-link">G1 GC核心原理介绍</a></li></ul></section></li></ul> </aside> <div><main class="withouttoc page"> <div class="theme-default-content content__default"><h1 id="g1-gc核心原理介绍"><a href="#g1-gc核心原理介绍" class="header-anchor">#</a> G1 GC核心原理介绍</h1> <p>今天让我们从0开始了解G1 GC。</p> <p>在开始之前，我们先探讨下为什么我们学习G1 GC。
要学习一些新知识，每个人可能都有不同的目的目标。
我认为学习G1GC对于Java工程师有如下收益。</p> <ol><li>成为更好的Java开发工程师，在遇到服务性能问题、GC问题时，能够通过了解到的G1知识快速定位、解决相关问题</li> <li>在面试时GC问题也是常问的知识点，G1GC作为大多数工程师了解不是很多的知识领域，如果稍微深入理解，就能形成更大的领先优势，无论是被面试还是面试别人</li> <li>学习G1中的优化技巧、原理，有机会能够举一反三应用到平时的工作设计中</li> <li>满足自己的好奇心，了解一项事物背后的运行流程。</li></ol> <p>目前大多数人对于G1 GC的知识理解可能来自G1 GC论文、oracle官方文档、《深入理解Java虚拟机》书籍、网络文章等。
而其中一些内容可能已经过时或描述不全面，本文会尽量给大家带来更准确、全面的G1理解。</p> <h2 id="g1核心设计思路介绍"><a href="#g1核心设计思路介绍" class="header-anchor">#</a> G1核心设计思路介绍</h2> <p>G1GC是Garbage First Garbage Collection的简写，G1读作G one或G 一都是可以的。
在jdk9之后的版本，G1已经成为默认的垃圾回收器。</p> <p>在G1出现之前，服务端Java服务普遍使用CMS（并发标记清除回收器），在暂定时间、吞吐量等方面G1相比CMS有全面的优化，
所以jdk9之后CMS也已经从jdk代码中移除不能再使用。</p> <p>那么CMS遇到了哪些问题呢？</p> <p>这要从GC暂停时间开始说起，在JVM运行时，除了有mutator应用线程（我们写的业务代码）执行，还有JVM内部的一些代码在运行就包括了GC的线程。
mutator是GC领域对于应用代码的称呼，mutator对堆内存中的对象进行创建、修改、使用。
目前绝大部分的Java GC在回收内存时，都或多或少地需要暂停mutator，后面我们会讲解暂停的原因。</p> <p>在GC过程中暂停mutator，暂停结束后，mutator继续运行。暂停可能导致请求耗时增加，如果较长会导致请求超时、用户体验变差、mutator访问外部资源超时
等问题。</p> <p>以CMS为例，CMS是用于回收老年代的收集器，对于年轻代需要使用ParNew回收，这样的组合存在以下问题。</p> <ol><li>年轻代和老年代的大小固定，而年轻代回收时的暂停时间和回收的内存区域相关，随着业务量级变大、业务代码复杂（比如更多本地缓存），需要的堆内存会变大所以暂停时间也会相应增加。</li> <li>对于老年代，CMS使用并发标记清除的方式，并发标记清除中虽然使用了很多并发处理技术降低mutator暂停时间，但是会带来内存碎片问题随着内存碎片增多，如果老年代内存持续增长可能会导致长时间暂停的Full GC</li> <li>为了解决内存碎片问题，CMS还提供了一个运行N次普通CMS后运行一次带Compaction压缩的CMS，而压缩涉及到存活对象的移动，对于老年代存活对象较多的情况，也会导致较长的暂停时间</li></ol> <p>所以CMS是不能保证/控制对于mutator的暂停时间的，而一些情况下我们希望控制系统的暂停时间，比如接口的响应时间有要求最大200ms，如果我们的GC暂停时间
就超过200ms，则这样的响应时间是无法得到保证的。</p> <p>为了解决这样的问题，G1 GC来了，G1 GC和CMS的核心区别也是G1的核心设计思想在于，动态控制每次回收的内存范围，通过控制内存回收区域，G1能够控制最大暂停时间，
并且G1回收时优先选择回收效率较高的内存区域提供吞吐量。</p> <p><img alt="g1-region" data-src="/assets/images/g1/g1-region.png" loading="lazy" class="lazy"></p> <p>G1将堆内存划分为若干个（接近2048个）相同大小的Region（区域），Region的大小会通过堆内存除以2048并向上查找最近的1MB, 2MB, 4MB, 8MB, 16MB, 32MB。
Region使用这样的大小目的是便于位运算，比如region大小为2MB，计算一个对象所在的region index只需要对对象地址(bit单位)左移24位(2的24次方个bit是2MB)。
G1 GC同样适用分代收集策略，每个Region可以属于年轻代（细分为Eden和Survivor)和老年代(Old)，没有对象的region类型是Free，存放大于region一半大小的region是Humongous巨型region。
每次回收时，G1会选择一部分region进行回收，经历多次年轻代回收的年轻代对象达到年轻阈值后会晋升到老年代region。
region的属性会随着GC运行而变化，比如一个region开始属于eden类型，region gc回收后变成Free，然后再后面可能变成Eden、Survivor、Old、Humongous中的任意一种。
这也意味着G1中的年轻代、老年代region不是连续的，并且G1能够动态调整年轻代的大小以便控制暂停时间。</p> <p>region类型总结</p> <ul><li>Eden - Eden region用于分配mutator的创建对象的内存，分配过程默认使用TLAB(Thread Local Allocation Buffer)提高多线程并发分配能力</li> <li>Survivor - 回收年轻代region时，存活对象会移动到Survivor区域，Survivor放不下的或者对象gc年龄超过晋升阈值的会移动到老年代region</li> <li>Old - 老年代region</li> <li>Humongous - 如果要分配的对象的大小大于等于region大小的一半，则会被G1认为是巨型对象，每个巨型对象会单独占用一个region或多个连续的region（大小超过1个region的情况），G1在运行过程中会避免巨型对象的移动，因为移动巨型对象的内存复制成本很高。巨型对象绝大部分是数组对象，非数组对象的大小只和字段数量有关，几乎不会有类有如此多的字段。巨型对象按照分代划分也划分到老年代。</li> <li>Free - 还没有分配过或回收完成的region，作为Free Region空闲region, Free Region可以转变为其他Region。</li></ul> <h3 id="g1-gc的运行周期"><a href="#g1-gc的运行周期" class="header-anchor">#</a> G1 GC的运行周期</h3> <p><img alt="g1-cycles.png" data-src="/assets/images/g1/g1-cycles.png" loading="lazy" class="lazy"></p> <p>G1在运行时，会分为多种运行模式。</p> <ol><li>Young Only GC - 默认情况下，G1会进行young only gc，young only表明G1只会回收年轻代region且会回收全部的年轻代region，年轻代region目标数量（达到指定数量后发起young only gc)可以动态调整。</li> <li>Concurrent Marking Cycle - 随着Young only gc的运行，不断有对象从年轻代晋升到老年代，并且程序运行中也会不断分配humongous，老年代和humongous region内存占用达到一定阈值（InitiatingHeapOccupancyPercent)，G1会发起Concurrent Marking Cycle并发标记周期，并发标记周期分为初始标记(Initial Marking)、并发标记(Concurrent Marking)、最终标记(Remark)、清理(Cleanup)多个阶段，并发标记周期的目的是对老年代进行标记、统计老年代region的存活对象、清理空region、计算collection set等。</li> <li>Mixed GC - Concurrent Marking Cycle结束后，G1会进行若干次Mixed GC，挑选上一步并发标记中计算出来回收效率最高（和存活对象占比有关）的若干个老年代region以及全部的年轻代region进行回收，回收达到一定次数或没有回收效率较高的老年代region后，会再次进入到Young Only GC阶段，如此往复。</li> <li>Full GC - 在G1运行过程中，如果出现一些异常情况，比如Young Only GC时，要晋升的存活对象没有可用的老年代region可以存放，则G1会回退到全暂停的Full GC，Full GC使用标记压缩方式回收全部堆内存，暂停时间最长。</li></ol> <h2 id="g1运行步骤"><a href="#g1运行步骤" class="header-anchor">#</a> G1运行步骤</h2> <h3 id="young-only-gc"><a href="#young-only-gc" class="header-anchor">#</a> Young Only GC</h3> <p>G1的Young Only GC要做的事情为</p> <p><img alt="img.png" data-src="/assets/images/g1/g1-young-only-1.png" loading="lazy" class="lazy"></p> <ul><li>计算要回收的region集合，Young Only GC要回收的是全部Young Region（Eden和Survivor)</li> <li>从GC Root开始，对存活对象进行对象图遍历标记</li> <li>对于存活对象，转移到survivor区域（或old region)，修改引用来源，指向新地址</li> <li>移动完对象后，在原有位置的旧对象头中设置标记位表示已经转移，并且保存转移后的地址到对象头中，这样遇到已经移动过的对象就不会重复移动了，并且能够读取出移动后的位置修改引用。</li> <li>更新remembered set</li></ul> <p><img alt="img.png" data-src="/assets/images/g1/g1-young-only-bfs.png" loading="lazy" class="lazy"></p> <p>进入safepoint后。G1就可以从GC ROOT开始遍历、移动存活对象了。</p> <p>G1的遍历标记流程类似广度优先遍历，维护一个队列，先从一些初始节点开始，处理存活对象，遍历存活对象的引用关系，加入到任务队列中。</p> <p>对于存活的对象，如果对象处于collection set中，G1会将其移动到survivor区域中（如果age超过晋升年龄会晋升到老年代），然后修改来源引用指向新地址。
然后G1会遍历该对象的引用类型字段，判断如果引用的对象在collection set中，则将这个引用放入到任务队列中。
如果不在collection set中，则需要更新维护remembered set。</p> <p>处理完一个引用后，会在引用目标对象原位置的对象头mark word存储新地址，然后设置一个标记标识当前对象已经处理过了。
这样在下次有其他引用的任务要处理时，就能发现该对象已经处理了不用重复处理，并且能从mark word中读取出新地址来修改来源引用。</p> <p>为了提高并行处理能力，G1每个gc worker线程会维护一个自己的任务队列，当本地队列中满了时会放到一个全局队列。
当某个gc worker完成自己的任务后，还会主动帮助其他gc worker处理任务(work steal)，降低整体的gc耗时。</p> <p>下图是young only中对gc root直接引用到的对象的处理过程。</p> <p><img alt="img.png" data-src="/assets/images/g1/g1-root-processor.png" loading="lazy" class="lazy"> <img alt="img.png" data-src="/assets/images/g1/g1-root-process-image.png" loading="lazy" class="lazy"></p> <p>下图是对于广度优先搜索中的队列中的任务的处理过程，和gc root的处理基本一致。</p> <p><img alt="img.png" data-src="/assets/images/g1/g1-processor-task.png" loading="lazy" class="lazy"></p> <h4 id="safepoint"><a href="#safepoint" class="header-anchor">#</a> Safepoint</h4> <p>前面我们提到的对mutator的暂停，就和safepoint有关。</p> <p><img alt="img.png" data-src="/assets/images/g1/safepoint-pause.png" loading="lazy" class="lazy"></p> <p>safepoint是jvm中的同步协调机制，当jvm希望执行一些操作，并且希望在执行这些操作过程中，其他的线程（mutator线程）处于暂停状态，就会使用safepoint。
gc、jstack、jmap、jcmd等命令都借助了safepoint机制。
jvm可以类比为加锁，存在进入safepoint，退出safepoint两种操作，在jvm希望进入safepoint时，会设置一个全局
标识，mutator线程在运行过程中不断（运行到特定类型的代码时）检查这个标识，如果发现要进入safepoint了，则会暂停自己的线程。
当所有的mutator线程都暂停后，jvm线程就可以执行gc等操作了，在safepoint中，由于不和mutator并发操作堆内存中的对象引用，避免了并发问题处理。</p> <p><img alt="img.png" data-src="/assets/images/g1/safepoint-gc-map.png" loading="lazy" class="lazy"></p> <p>另外safepoint的一个重要功能是GC Root，mutator线程在运行过程中，每个线程都有自己的线程栈，线程栈是一个栈结构，每个栈帧中都包含
局部变量表、操作数栈，局部变量表和操作数栈中每个slot（槽位）存储的值的类型，有可能是引用、也有可能是数值（int、boolean等），
线程栈中的引用类型则需要作为GC Root用于对象图遍历。
hotspot jvm使用的是准确式gc，也就是不会错把一个数值类型的数据当成引用，这是通过在进入safepoint前，jvm生成gc map的方式实现的，
gc map保存了当前线程栈的局部变量表、操作数栈中哪个位置是引用，这样gc过程中，jvm就能准确的找出所有的gc root进行遍历。
生成gc map存在性能和空间开销，为了降低开销，mutator只在特定的代码位置才会进入safepoint（方法进入、返回、uncounted loop backedge无界循环回边等jvm认为可能会长时间执行代码的位置)。</p> <p>前面提到的准确式GC的优势是什么呢？因为G1 GC中使用复制算法对对象进行移动，并且修改来源引用，如果不准确比如把一个数值当做引用进行了移动，在修改引用值时就会
错误得修改对应的数值。而准确式GC只会修改引用，不会出现这种问题。</p> <h4 id="remembered-set"><a href="#remembered-set" class="header-anchor">#</a> remembered set</h4> <p><img alt="img.png" data-src="/assets/images/g1/rem-set-ref.png" loading="lazy" class="lazy"></p> <p>G1在Young Only GC和Mixed GC时，有一个特点，就是只会回收堆内存中的一部分区域，比如Young Only GC只回收Young Region。
这就为GC的实现带来了一些困难，因为要对对象图进行遍历。</p> <ol><li>如果遍历全部对象，则遍历耗时会随着堆内存（存活对象）变大而增大</li> <li>如果不遍历老年代，则可能出现年轻代中存活对象漏标的情况，比如有老年代的存活对象指向一个年轻代的对象，这个对象也是存活对象。</li></ol> <p><img alt="img.png" data-src="/assets/images/g1/rem-set-write-barrier.png" loading="lazy" class="lazy"></p> <p>为了解决这个问题，G1通过空间换时间（gc暂停时间）的思想进行了优化，G1为每个region保存了一个Remembered Set简称RemSet。
Remembered Set保存的是来自其他region（old region）到当前region的引用信息，即有哪些来源引用指向当前region。
为什么只记录来自old region的引用呢？因为每次gc时，无论是young only还是mixed，都会遍历全部的young region，所以young region对于其他region的
引用都会遍历到，不需要再记录。
引用数据会在G1中通过Write Barrier机制记录，Write Barrier能够在jvm执行引用代码过程中，出现引用修改的前后执行特定的代码，
G1的修改引用后，会执行维护remset的代码，G1判断引用来自非年轻代（老年代）则会对将来源引用记录到被引用对象的region的remset中。</p> <p><img alt="img.png" data-src="/assets/images/g1/rem-set-optimize.png" loading="lazy" class="lazy"></p> <p>这是还会出现几个性能问题</p> <p>在Write Barrier中同步修改remset可能导致应用代码执行变慢，为此G1会将数据相关写入到一个队列中，异步处理，并且为了降低线程间的冲突减少同步，会先将数据写入到线程本地队列中，本地队列满之后放到全局队列，后台有若干个gc线程负责消费这些数据</p> <p>重复数据多、内存占用高，比如一个老年代的对象的引用字段，不断修改到另一个region中的对象，那么会在队列中产生大量重复数据。
为此G1做了两个优化，1是将数据以card维度记录，每个card表示512byte的内存范围；2是增加了一个card table，card table起到去重的作用，
card table通过数组实现，数组的索引表示card（能够映射到堆内存中的512byte的范围），数组中的值是byte，其中0表示clean，1表示dirty，dirty指对应的
card已经放入到队列中了，G1在Write Barrier中会检查和修改card table，如果发现card table上对应的card value已经是dirty了则不需要重复入队。</p> <p>G1通过N个ConcurrentRefineThread来处理全局队列中的card，并且根据card数量调节线程数量，在ConcurrentRefineThread处理不过来时，
mutator也会参与到remset维护中。同时如果全局队列中的card比较少，ConcurrentRefineThread也不会处理，目的是保持一定的card table的dirty数量，用于去重（缓存）。</p> <p>从队列中获取出来card后，还会保存一个HotCardCache用于记录热点card，对于热点card不会记录到remset中，而是在GC时单独处理。
不是热点的card，会先清理card table设置为clean，然后扫描对应card的内存范围，找出引用关系对，把每个引用关系对，把来源card到被引用对象所在的region的remset中。</p> <p><img alt="img.png" data-src="/assets/images/g1/rem-set-structure.png" loading="lazy" class="lazy"></p> <p>每个Region的RemSet这个数据结构内部，通过多种粒度的存储来保存来源信息。
当card数量较少时，通过SparseTable稀疏表精确记录对应的region和card集合，可以理解为<code>map&lt;region, set&lt;card&gt;&gt;</code>;
当card数量变多时，G1开始把card较多的region转换为bitmap结构，可以理解为<code>map&lt;region, bitmap&lt;card&gt;</code>，map的value即bitmap表示对应来源region中的哪些card中有指向当前region的引用
当card数量继续变多时，G1开始将一些region通过coarse map即粗粒度map存储，coarse map是bitmap，bitmap中某一个位有true，表示对应的region有引用。</p> <p>下面是remset相关的代码</p> <p><img alt="img.png" data-src="/assets/images/g1/rem-set-code1.png" loading="lazy" class="lazy"> <img alt="img.png" data-src="/assets/images/g1/rem-set-code2.png" loading="lazy" class="lazy"> <img alt="img.png" data-src="/assets/images/g1/rem-set-code3.png" loading="lazy" class="lazy"></p> <h4 id="humongous回收"><a href="#humongous回收" class="header-anchor">#</a> Humongous回收</h4> <h3 id="concurrent-marking-cycle"><a href="#concurrent-marking-cycle" class="header-anchor">#</a> Concurrent Marking Cycle</h3> <p>老年代（包括humongous)region不断增长，当占整个堆内存的比例超过一定阈值（InitiatingHeapOccupancyPercent，简称IHOP）后，G1会发起
Concurrent Marking Cycle并发标记周期。</p> <p>这个检查时机发生在young only gc结束时或为humongous object分配内存时。</p> <p>并发标记周期分为如下4个步骤</p> <ol><li>初始标记 Initial Mark</li> <li>并发标记 Concurrent Mark</li> <li>最终标记/重新标记 Remark</li> <li>并发清理 Cleanup</li></ol> <h4 id="initial-mark"><a href="#initial-mark" class="header-anchor">#</a> Initial Mark</h4> <p>初始标记的目的是为了给之后的并发标记构建初始的遍历节点，并发标记的目的是为了标记老年代中的存活对象。
所以初始标记会标记从GC root能够直接访问到的老年代的对象。</p> <p><img alt="img.png" data-src="/assets/images/g1/concurrent-start-marking.png" loading="lazy" class="lazy"></p> <p><img alt="img.png" data-src="/assets/images/g1/concurrent-start-marking2.png" loading="lazy" class="lazy"></p> <p>初始标记会通过发起一次young only gc(Concurrent Start)完成，特殊之处在于这次young gc的扫描gc root时，如果发现有从gc root
到老年代的引用，则会将对应的老年代对象保存到concurrent marking bitmap中。
concurrent marking bitmap是G1用于并发标记的数据结构，每个bit表示8byte的位置（因为hotspot jdk的对象地址使用8字节对齐），
并且G1中存在两个marking bitmap，一个prev一个next，next表示当前正在遍历标记的bitmap，prev表示已经遍历标记完的。
所以G1中marking bitmap会占用 堆内存大小 / 64 * 2 也就是堆内存/32的内存空间。</p> <p><img alt="img.png" data-src="/assets/images/g1/concurrent-start-marking3.png" loading="lazy" class="lazy"></p> <h4 id="concurrent-mark"><a href="#concurrent-mark" class="header-anchor">#</a> Concurrent Mark</h4> <p>并发标记阶段并发标记线程和mutator并发执行</p> <h5 id="satb和tams"><a href="#satb和tams" class="header-anchor">#</a> SATB和TAMS</h5> <p>并发标记中的并发问题。
在并发线程运行过程中，mutator也在运行，这里可能出现并发问题导致存活对象被漏掉。</p> <p>为了便于讨论，先学习一下gc领域的黑灰白三色标记。标记是指标记对应的对象为存活对象。</p> <ul><li>黑色 - 该对象已经标记，且该对象的引用字段也都已经处理完或已经加到任务队列中</li> <li>灰色 - 该对象已经标记，但是对象的引用字段还没有处理完</li> <li>白色 - 该对象还没有标记</li></ul> <p><img alt="img.png" data-src="/assets/images/g1/satb-black-gray-white.png" loading="lazy" class="lazy"></p> <p>现在存在A, B, C三个对象，A是黑色，B是灰色，C是白色。
在时间点1，A引用了B，B引用了C。
在时间点2，mutator修改增加了A到C的引用、B删掉了到C的引用，且C没有来自其他对象的引用。
在时间点2，并发标记线程对灰色的B对象的字段进行处理，但是此时B已经删了到C的引用，A对象增加了对C的引用，但是A已经是黑色对象，标记线程不会再标记C对象。
最终C对象虽然有来自存活对象的引用，但是却没有被标记为存活对象，出现了漏标。</p> <p><img alt="img.png" data-src="/assets/images/g1/satb-write-barrier.png" loading="lazy" class="lazy"></p> <p>漏标出现说明出现了引用的删除，G1的解决方案是在引用修改时，增加了一个Write Barrier，比如把A的字段从旧的引用C改到了D，则会把C放入到一个SATB队列中。
并发标记线程也会从SATB队列中读出对象并标记到marking bitmap中。</p> <p>satb是snapshot at the beginning的缩写，意思是在并发标记开始时存活的对象都认为是存活对象，及时标记过程中可能不再存活，比如如果前面的C没有得到A的引用，则
A应该是一个不存活的对象，但是也被标记为存活了，也就是存在一定的浮动垃圾，不过优点是不会出现漏标问题。</p> <p><img alt="img.png" data-src="/assets/images/g1/tams.png" loading="lazy" class="lazy"></p> <p>另外一个并发问题是，并发标记开始之后创建的对象，应该也是存活对象，G1为了解决这种问题，会在并发标记开始时，对每个region记录一个当前内存分配位置top的值，称为
TopAtMarkStart简称TAMS，在TAMS之上的对象都认为是存活对象。</p> <h4 id="remark"><a href="#remark" class="header-anchor">#</a> Remark</h4> <p>Remark阶段的作用是结束上一步的并发标记，因为mutator在不断修改堆中的对象，Remark会在safepoint中执行，所以能够暂停mutator，
把mutator线程本地的satb队列和全局satb队列中的待处理的对象遍历标记处理完，然后就完成了老年代的存活对象标记。
Remark过程最后还会查看老年代是否有空的region（即没有存活对象的老年代region），进行提前回收。</p> <h4 id="cleanup"><a href="#cleanup" class="header-anchor">#</a> Cleanup</h4> <p>cleanup阶段会和mutator并发执行，负责计算各个old region的回收效率 <code>reclaimable_bytes() / region_elapsed_time_ms</code>
region的存活对象越少（可回收内存越多）、rembered set数量越少，回收效率越高。
然后按照回收效率排序计算后面几次Mixed GC中每次回收的region。</p> <h3 id="mixed-gc"><a href="#mixed-gc" class="header-anchor">#</a> Mixed GC</h3> <p>Concurrent Marking Cycle结束后，G1会先进行一次Young GC Before Mixed GC，目的是调整下Young Region的数量。
然后会进行N次的Mixed GC。
每次Mixed GC，会选择全部的Young Region和一部分Old Region进行回收。</p> <p>回收的执行过程和Young Only GC基本一致。</p> <h2 id="g1常用参数配置、介绍"><a href="#g1常用参数配置、介绍" class="header-anchor">#</a> G1常用参数配置、介绍</h2> <ul><li>InitialRAMPercentage - 和下面的Max一起控制堆内存的初始和最大大小占机器内存比例，适用于容器环境，建议配置成相同值，如果指定具体的值使用 -Xms和-Xmx</li> <li>MaxRAMPercentage</li> <li>MaxGCPauseMillis - 最大暂停时间，G1会尽量满足此配置，默认200</li> <li>G1NewSizePercent - 年轻代最小比例，默认5</li> <li>G1MaxNewSizePercent - 年轻代最大比例，默认60</li> <li>G1ReservePercent - 为年轻代晋升保留的内存，默认10</li> <li>G1UseAdaptiveIHOP - 自适应调节IHOP，默认开启</li> <li>InitiatingHeapOccupancyPercent - 默认的IHOP，45，如果开始上面的自适应，会自动调节</li> <li>G1HeapRegionSize - Region大小，默认通过堆内存计算，可以通过参数覆盖</li> <li>ParallelGCThreads - 并行worker线程数量，比如Young Only GC时worker的数量</li> <li>ConcGCThreads - 并发worker线程数量，比如Concurrent Marking线程数量，如果设置较多concurrent marking更快但可能和mutator争抢较多cpu资源</li> <li>G1ConcRefinementThreads - 处理rem set的后台线程数量，默认等于ConcGCThreads</li></ul> <h3 id="gc日志"><a href="#gc日志" class="header-anchor">#</a> GC日志</h3> <p>在jdk11即以上版本，GC的日志使用了新的配置方法。</p> <p>启动时配置JVM参数</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>-Xlog:gc*=debug,safepoint=info:gc.log::filecount=1,filesize=100M
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>运行时可以通过jcmd动态配置gc日志</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>jcmd $pid VM.log output=&quot;file=/tmp/gc.log&quot; output_options=&quot;filecount=5,filesize=10m&quot; what=&quot;gc*=debug&quot; decorators=&quot;time,level&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参考 <a href="https://docs.azul.com/prime/Unified-GC-Logging" target="_blank" rel="noopener noreferrer">Unified-GC-Logging<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="g1常见问题、分析解决方法"><a href="#g1常见问题、分析解决方法" class="header-anchor">#</a> G1常见问题、分析解决方法</h2> <h3 id="fullgc、mixed-gc频繁"><a href="#fullgc、mixed-gc频繁" class="header-anchor">#</a> FullGC、Mixed GC频繁</h3> <p>Mixed GC频繁一般发生在老年代存活对象较多，且关闭自适应调节IHOP即设置了<code>-XX:-G1UseAdaptiveIHOP</code>的情况，这种情况下
G1会使用固定的IHOP默认是45%(<code>-XX:InitiatingHeapOccupancyPercent</code>)。</p> <ol><li>调大堆内存</li> <li>调高<code>-XX:InitiatingHeapOccupancyPercent</code></li> <li>不设置<code>-XX:-G1UseAdaptiveIHOP</code></li> <li>优化程序，通过histo或dump后通过idea的profiler或mat等工具查看对象内存占用，减少老年代存活对象的数量，比如通过<code>jmap -histo</code>查看排名靠前的类</li></ol> <h3 id="young-gc-mixed-gc耗时高"><a href="#young-gc-mixed-gc耗时高" class="header-anchor">#</a> Young GC Mixed GC耗时高</h3> <p><a href="https://docs.oracle.com/javase/9/gctuning/garbage-first-garbage-collector-tuning.htm" target="_blank" rel="noopener noreferrer">Garbage-First Garbage Collector Tuning<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="设计总结"><a href="#设计总结" class="header-anchor">#</a> 设计总结</h2> <ul><li>异步延迟批量处理， remembered set维护，dirty card的延迟批量处理</li> <li>线程本地队列、异步处理、减少线程间冲突</li> <li>remembered set空间换时间</li></ul> <h2 id="更多参考资料"><a href="#更多参考资料" class="header-anchor">#</a> 更多参考资料</h2> <ul><li><a href="http://cs.williams.edu/~dbarowy/cs334s18/assets/p37-detlefs.pdf" target="_blank" rel="noopener noreferrer">《G1 GC论文》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>《深入jvm虚拟机: jvm g1gc的算法与实现》</li> <li><a href="https://docs.oracle.com/javase/9/gctuning/garbage-first-garbage-collector.htm" target="_blank" rel="noopener noreferrer">Garbage-First Garbage Collector oracle 文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/liuzhengyang/liuzhengyang.github.io/edit/master/docs/md/jvm/gc/g1/g1-all-intro.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----> </main></div> <aside class="page-sidebar"> <div class="page-side-toolbar"><!----> <div class="option-box-toc-over"><img src="/images/system/toc.png" class="nozoom"> <span class="show-txt">目录</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:550px"><div style="font-weight:bold;text-align:center;">G1 GC核心原理介绍</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/md/jvm/gc/g1/g1-all-intro.html#g1核心设计思路介绍" class="toc-sidebar-link">G1核心设计思路介绍</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/md/jvm/gc/g1/g1-all-intro.html#g1-gc的运行周期" class="toc-sidebar-link">G1 GC的运行周期</a></li></ul></li><li><a href="/md/jvm/gc/g1/g1-all-intro.html#g1运行步骤" class="toc-sidebar-link">G1运行步骤</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/md/jvm/gc/g1/g1-all-intro.html#young-only-gc" class="toc-sidebar-link">Young Only GC</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/gc/g1/g1-all-intro.html#concurrent-marking-cycle" class="toc-sidebar-link">Concurrent Marking Cycle</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/gc/g1/g1-all-intro.html#mixed-gc" class="toc-sidebar-link">Mixed GC</a></li></ul></li><li><a href="/md/jvm/gc/g1/g1-all-intro.html#g1常用参数配置、介绍" class="toc-sidebar-link">G1常用参数配置、介绍</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/md/jvm/gc/g1/g1-all-intro.html#gc日志" class="toc-sidebar-link">GC日志</a></li></ul></li><li><a href="/md/jvm/gc/g1/g1-all-intro.html#g1常见问题、分析解决方法" class="toc-sidebar-link">G1常见问题、分析解决方法</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/md/jvm/gc/g1/g1-all-intro.html#fullgc、mixed-gc频繁" class="toc-sidebar-link">FullGC、Mixed GC频繁</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/gc/g1/g1-all-intro.html#young-gc-mixed-gc耗时高" class="toc-sidebar-link">Young GC Mixed GC耗时高</a></li></ul></li><li><a href="/md/jvm/gc/g1/g1-all-intro.html#设计总结" class="toc-sidebar-link">设计总结</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/jvm/gc/g1/g1-all-intro.html#更多参考资料" class="toc-sidebar-link">更多参考资料</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box"><img src="/images/system/wechat.png" class="nozoom"> <span class="show-txt">手机看</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.9rem">微信扫一扫</span> <img height="180px" src="https://api.qrserver.com/v1/create-qr-code/?data=https://bytejava.cn/md/jvm/gc/g1/g1-all-intro.html" style="margin:10px;">
                可以<b>手机看</b>或分享至<b>朋友圈</b></div></div></div></div> <div class="option-box"><img src="/images/personal/wechat-mp-logo.jpg" height="20" class="nozoom"> <span class="show-txt">公众号</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.9rem">关注公众号bytejava</span> <img src="/images/personal/wechat-mp.png" height="180" width></div></div></div></div> <div class="option-box"><img src="/images/system/toggle.png" width="30px" class="nozoom"> <span class="show-txt">左栏</span></div> <div class="option-box"><img src="/images/system/heart-1.png" width="25px" class="nozoom"> <span class="show-txt">赞赏我</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.8rem;font-weight:bold;">鼓励/支持/赞赏我</span> <img height="180px" src="/images/personal/encourage-head.jpg" style="margin:5px;"> <br>1. 不靠它生存但仍希望得到你的鼓励；
                <br>2. 时刻警醒自己保持技术人的初心，沉淀，分享，成长；
              </div></div></div></div> <!----> <!----></div>  <!----> </aside></div><div class="global-ui"></div></div>
    <script src="/assets/js/cg-styles.js?v=1729221831211" defer></script><script src="/assets/js/cg-4.js?v=1729221831211" defer></script><script src="/assets/js/cg-3.js?v=1729221831211" defer></script><script src="/assets/js/cg-162.js?v=1729221831211" defer></script><script src="/assets/js/cg-app.js?v=1729221831211" defer></script>
  </body>
</html>
