<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TLAB | bytejava Java进阶手册</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <script charset="utf-8" async="async" src="/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/js/global.js"></script>
    <script charset="utf-8" async="async" src="/js/fingerprint2.min.js"></script>
    <script charset="utf-8" async="async" src="https://s9.cnzz.com/z_stat.php?id=12782949&amp;web_id=1272949"></script>
    <script>
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?fa0fbf0fef3bba94118b912a64766cee";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            </script>
    <meta name="description" content="包含: Java 基础，高并发缓存，JVM，中间件，字节码编程...">
    <meta property="og:title" content="TLAB">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/md/jvm/jvm/tlab.html">
    <meta name="twitter:title" content="TLAB">
    <meta name="twitter:url" content="/md/jvm/jvm/tlab.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="robots" content="all">
    <meta name="author" content="bytejava">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="keywords" content="bytejava 高级Java，Java设计模式, 字节码编程, 中间件, Spring, Java基础, 面经手册">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.8fb5e8ac.css" as="style"><link rel="preload" href="/assets/css/styles.css?v=1729221831211" as="style"><link rel="preload" href="/assets/js/cg-styles.js?v=1729221831211" as="script"><link rel="preload" href="/assets/js/cg-app.js?v=1729221831211" as="script"><link rel="preload" href="/assets/js/cg-4.js?v=1729221831211" as="script"><link rel="preload" href="/assets/js/cg-3.js?v=1729221831211" as="script"><link rel="preload" href="/assets/js/cg-220.js?v=1729221831211" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.8fb5e8ac.css"><link rel="stylesheet" href="/assets/css/styles.css?v=1729221831211">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">bytejava Java进阶手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/basic/java线程池.html" class="nav-link">
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/md/java/compiler/javac.html" class="nav-link">
  Java编译器
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JVM" class="dropdown-title"><span class="title">JVM</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/jvm/bytecode/class字节码文件格式.html" class="nav-link">
  字节码
</a></li><li class="dropdown-item"><!----> <a href="/md/jvm/jvm/javaagent.html" class="nav-link">
  jvm
</a></li><li class="dropdown-item"><!----> <a href="/md/jvm/jvmti/jvmti介绍和开发.html" class="nav-link">
  jvmti
</a></li><li class="dropdown-item"><!----> <a href="/md/jvm/gc/g1/g1-all-intro.html" class="nav-link">
  G1 GC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存" class="dropdown-title"><span class="title">缓存</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/cache/redis/redis.html" class="nav-link">
  零基础到高并发应用专家，深入理解redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><span class="title">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/springboot启动请求处理过程.html" class="nav-link">
  Spring实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Kafka" class="dropdown-title"><span class="title">Kafka</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/kafka/kafka.html" class="nav-link">
  kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MyBatis" class="dropdown-title"><span class="title">MyBatis</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/mybatis/mybatis-use-general.html" class="nav-link">
  MyBatis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="业务开发" class="dropdown-title"><span class="title">业务开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/develop/" class="nav-link">
  业务开发
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/distribute/raft.html" class="nav-link">
  raft
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/algorithm/leetcode.html" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软技能通用技能" class="dropdown-title"><span class="title">软技能通用技能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/soft/晋升答辩.html" class="nav-link">
  晋升答辩
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><span class="title">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/column/column.html" class="nav-link">
  订阅我的专栏
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/liuzhengyang" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/java/basic/java线程池.html" class="nav-link">
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/md/java/compiler/javac.html" class="nav-link">
  Java编译器
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JVM" class="dropdown-title"><span class="title">JVM</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/jvm/bytecode/class字节码文件格式.html" class="nav-link">
  字节码
</a></li><li class="dropdown-item"><!----> <a href="/md/jvm/jvm/javaagent.html" class="nav-link">
  jvm
</a></li><li class="dropdown-item"><!----> <a href="/md/jvm/jvmti/jvmti介绍和开发.html" class="nav-link">
  jvmti
</a></li><li class="dropdown-item"><!----> <a href="/md/jvm/gc/g1/g1-all-intro.html" class="nav-link">
  G1 GC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存" class="dropdown-title"><span class="title">缓存</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/cache/redis/redis.html" class="nav-link">
  零基础到高并发应用专家，深入理解redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><span class="title">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/springboot启动请求处理过程.html" class="nav-link">
  Spring实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Kafka" class="dropdown-title"><span class="title">Kafka</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/kafka/kafka.html" class="nav-link">
  kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MyBatis" class="dropdown-title"><span class="title">MyBatis</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/mybatis/mybatis-use-general.html" class="nav-link">
  MyBatis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="业务开发" class="dropdown-title"><span class="title">业务开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/develop/" class="nav-link">
  业务开发
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/distribute/raft.html" class="nav-link">
  raft
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/algorithm/leetcode.html" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软技能通用技能" class="dropdown-title"><span class="title">软技能通用技能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/soft/晋升答辩.html" class="nav-link">
  晋升答辩
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专栏" class="dropdown-title"><span class="title">专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/column/column.html" class="nav-link">
  订阅我的专栏
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/liuzhengyang" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JVM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/jvm/jvm/build-jdk.html" class="sidebar-link">在2024年使用Clion编译、debug、开发Java虚拟机(Mac版本)</a></li><li><a href="/md/jvm/jvm/javaagent.html" class="sidebar-link">javaagent</a></li><li><a href="/md/jvm/jvm/jstack.html" class="sidebar-link">jstack实现原理分析</a></li><li><a href="/md/jvm/jvm/string-deduplication.html" class="sidebar-link">String Deduplication</a></li><li><a href="/md/jvm/jvm/tlab.html" aria-current="page" class="active sidebar-link">TLAB</a></li><li><a href="/md/jvm/jvm/synchronizer.html" class="sidebar-link">synchronzier</a></li><li><a href="/md/jvm/jvm/monitor.html" class="sidebar-link">synchronized、monitor lock加锁流程</a></li><li><a href="/md/jvm/jvm/virtualthread/virtual-thread.html" class="sidebar-link">JDK Virtual Thread的实现</a></li></ul></section></li></ul> </aside> <div><main class="page"> <div class="theme-default-content content__default"><h1 id="tlab"><a href="#tlab" class="header-anchor">#</a> TLAB</h1> <p>TLAB(Thread Local Allocation Buffer)是jvm用来提升对象内存分配速度的机制。</p> <p>TLAB和id生成器中很多地方又有类似的设计思想。</p> <p>假如我们要设计一个内存分配器，给一个对象分配内存空间，可以通过一个top指针指向当前内存的位置，如果有对象要分配，则将
top加上对象的大小得到新的top值，则老的top到新的top之间的空间就分配给这个对象了。
但是在实际使用过程中，多线程都在申请内存，那么top的修改就会出现比较多的冲突，为了减少线程间的冲突，可以采用本地缓存的思想，
每个线程每次拿一大块内存，自己慢慢分配使用，用完了再来申请下一大块内存，由此就降低了线程间的冲突，提升了分配效率。
这就是Thread Local Allocation Buffer简称TLAB的核心思想。</p> <p>在实际进行分配时，申请的TLAB的大小、TLAB什么时候更换新的，也是需要考虑的，
TLAB太小，可能会出现对象频繁放不下，放不下我们只能回退到比较慢的到eden中去分配内存或者更换新的TLAB。
TLAB如果太大，线程比较多的情况下，可能会导致内存不够用。
TLAB什么时候更换新的也有讲究，TLAB最后剩下了一块内存，如果一直不更换新的TLAB，则可能会有大量的对象分配使用不了TLAB而降级到
避免慢的慢速分配，如果轻易就更换新的TLAB，则之前的TLAB中剩余的内存就浪费了，所以要在分配速度和内存浪费之间取得一个权衡，在jdk中
能够通过参数控制浪费的比例并且有自动调节机制。</p> <h2 id="tlab的配置"><a href="#tlab的配置" class="header-anchor">#</a> TLAB的配置</h2> <p>TLAB相关的配置可以通过<code>java -XX:+UnlockDiagnosticVMOptions -XX:+UnlockExperimentalVMOptions -XX:+PrintFlagsFinal -version | grep 'TLAB'</code>
命令查看。</p> <p>ResizeTLAB</p> <h2 id="tlab的实现"><a href="#tlab的实现" class="header-anchor">#</a> TLAB的实现</h2> <h3 id="usetlab"><a href="#usetlab" class="header-anchor">#</a> UseTLAB</h3> <p>是否使用TLAB，默认为true。对于大多数应用，也不建议关闭。</p> <h3 id="resizetlab"><a href="#resizetlab" class="header-anchor">#</a> ResizeTLAB</h3> <p>是否动态调整TLAB的大小，默认为true。一般也不建议关闭，因为如果关闭，TLAB的大小固定，很考验TLAB大小的设置，而不能利用自动调整
机制中分配效率和内存浪费间进行权衡。</p> <h3 id="mintlabsize"><a href="#mintlabsize" class="header-anchor">#</a> MinTLABSize</h3> <p>TLAB的最小的大小，单位是bytes，默认2k。</p> <h3 id="tlabsize"><a href="#tlabsize" class="header-anchor">#</a> TLABSize</h3> <p>初始时TLAB的大小，默认值0，则</p> <p>TLAB size size change</p> <p>jvm word是什么含义</p> <p>dummy object
_word_size
retire
refill
inside tlab
outside tlab
slow alloc
fast alloc</p> <p>TLAB保存、gc回收</p> <p>和GC的关系</p> <p>浪费的数量</p> <h3 id="关键概念、流程"><a href="#关键概念、流程" class="header-anchor">#</a> 关键概念、流程</h3> <p>对象内存分配过程</p> <p>collectedHeap.inline.hpp中定义了在heap中创建对象申请内存的方法</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>inline oop CollectedHeap::obj_allocate(Klass* klass, size_t size, TRAPS) {
  ObjAllocator allocator(klass, size, THREAD);
  return allocator.allocate();
}

inline oop CollectedHeap::array_allocate(Klass* klass, size_t size, int length, bool do_zero, TRAPS) {
  ObjArrayAllocator allocator(klass, size, length, do_zero, THREAD);
  return allocator.allocate();
}

inline oop CollectedHeap::class_allocate(Klass* klass, size_t size, TRAPS) {
  ClassAllocator allocator(klass, size, THREAD);
  return allocator.allocate();
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>ObjAllocator等都继承与MemAllocator，调用memAllocator.cpp中的allocate方法负责创建对象
mem_allocate方法判断如果启用了UseTLAB，先调用allocate_inside_tlab尝试中tlab中申请，
如果申请失败，调用allocate_outside_tlab中tlab之外申请。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>oop MemAllocator::allocate() const {
  oop obj = NULL;
  {
    Allocation allocation(*this, &amp;obj);
    HeapWord* mem = mem_allocate(allocation);
    if (mem != NULL) {
      obj = initialize(mem);
    } else {
      // The unhandled oop detector will poison local variable obj,
      // so reset it to NULL if mem is NULL.
      obj = NULL;
    }
  }
  return obj;
}
HeapWord* MemAllocator::mem_allocate(Allocation&amp; allocation) const {
  if (UseTLAB) {
    HeapWord* result = allocate_inside_tlab(allocation);
    if (result != NULL) {
      return result;
    }
  }

  return allocate_outside_tlab(allocation);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>allocate_inside_tlab方法先调用allocate_inside_tlab_fast尝试中当前tlab申请进行分配，
如果当前tlab剩余空间无法容纳要分配的对象大小，则返回NULL，否则分配成功返回。
分配失败后调用allocate_inside_tlab_slow，判断下是否可以更换当前的tlab，更换一块新的tlab内存，
如果更换成功，在新的里面分配对象，否则返回NULL。</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>HeapWord* MemAllocator::allocate_inside_tlab(Allocation&amp;amp; allocation) const {
  assert(UseTLAB, &quot;should use UseTLAB&quot;);

  // Try allocating from an existing TLAB.
  HeapWord* mem = allocate_inside_tlab_fast();
  if (mem != NULL) {
    return mem;
  }

  // Try refilling the TLAB and allocating the object in it.
  return allocate_inside_tlab_slow(allocation);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>allocate_inside_tlab_fast调用的是ThreadLocalAllocBuffer的allocate方法</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>HeapWord* MemAllocator::allocate_inside_tlab_fast() const {
  return _thread-&gt;tlab().allocate(_word_size);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>threadLocalAllocBuffer.inline.hpp中定义了allocate的实现，判断当前
end和top之间的差也就是当前剩余的内存空间，是否大于等于size，即能否放下新对象，
如果放不下，返回NULL。如果可以，则向分配中的空间填充badHeapWordVal（header不会填充），然后更新top值（加上size）。</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>inline HeapWord* ThreadLocalAllocBuffer::allocate(size_t size) {
  invariants();
  HeapWord* obj = top();
  if (pointer_delta(end(), obj) &gt;= size) {
    // successful thread-local allocation
#ifdef ASSERT
    // Skip mangling the space corresponding to the object header to
    // ensure that the returned space is not considered parsable by
    // any concurrent GC thread.
    size_t hdr_size = oopDesc::header_size();
    Copy::fill_to_words(obj + hdr_size, size - hdr_size, badHeapWordVal);
#endif // ASSERT
    // This addition is safe because we know that top is
    // at least size below end, so the add can't wrap.
    set_top(obj + size);

    invariants();
    return obj;
  }
  return NULL;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>allocate_inside_tlab_slow方法负责中tlab_fast失败之后（即当前剩余空间不够分配新对象），判断是否要替换tlab。
should_post_sampled_object_alloc负责处理jvmti的sample逻辑，我们暂时不用关心。
然后回判断tlab.free()是否大于tlab.refill_waste_limit()，refill_waste_limit是
当前更换tlab允许浪费的内存的一个limit限制，小于等于它才能替换tlab，否则直接返回NULL，refill_waste_limit值也会动态调整稍后讲到。
如果free小于等于refill_waste_limit，则通过<code>tlab.compute_size(_word_size)</code>计算下一个要创建的tlab的大小
然后通过Universe::heap()-&gt;allocate_new_tlab创建新的tlab，然后在新的tlab中给对象分配内存并返回。</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>HeapWord* MemAllocator::allocate_inside_tlab_slow(Allocation&amp;amp; allocation) const {
  HeapWord* mem = NULL;
  ThreadLocalAllocBuffer&amp;amp; tlab = _thread-&gt;tlab();

  if (JvmtiExport::should_post_sampled_object_alloc()) {
    tlab.set_back_allocation_end();
    mem = tlab.allocate(_word_size);

    // We set back the allocation sample point to try to allocate this, reset it
    // when done.
    allocation._tlab_end_reset_for_sample = true;

    if (mem != NULL) {
      return mem;
    }
  }

  // Retain tlab and allocate object in shared space if
  // the amount free in the tlab is too large to discard.
  if (tlab.free() &gt; tlab.refill_waste_limit()) {
    tlab.record_slow_allocation(_word_size);
    return NULL;
  }

  // Discard tlab and allocate a new one.
  // To minimize fragmentation, the last TLAB may be smaller than the rest.
  size_t new_tlab_size = tlab.compute_size(_word_size);

  tlab.retire_before_allocation();

  if (new_tlab_size == 0) {
    return NULL;
  }

  // Allocate a new TLAB requesting new_tlab_size. Any size
  // between minimal and new_tlab_size is accepted.
  size_t min_tlab_size = ThreadLocalAllocBuffer::compute_min_size(_word_size);
  mem = Universe::heap()-&gt;allocate_new_tlab(min_tlab_size, new_tlab_size, &amp;amp;allocation._allocated_tlab_size);
  if (mem == NULL) {
    assert(allocation._allocated_tlab_size == 0,
           &quot;Allocation failed, but actual size was updated. min: &quot; SIZE_FORMAT
           &quot;, desired: &quot; SIZE_FORMAT &quot;, actual: &quot; SIZE_FORMAT,
           min_tlab_size, new_tlab_size, allocation._allocated_tlab_size);
    return NULL;
  }
  assert(allocation._allocated_tlab_size != 0, &quot;Allocation succeeded but actual size not updated. mem at: &quot;
         PTR_FORMAT &quot; min: &quot; SIZE_FORMAT &quot;, desired: &quot; SIZE_FORMAT,
         p2i(mem), min_tlab_size, new_tlab_size);

  if (ZeroTLAB) {
    // ..and clear it.
    Copy::zero_to_words(mem, allocation._allocated_tlab_size);
  } else {
    // ...and zap just allocated object.
#ifdef ASSERT
    // Skip mangling the space corresponding to the object header to
    // ensure that the returned space is not considered parsable by
    // any concurrent GC thread.
    size_t hdr_size = oopDesc::header_size();
    Copy::fill_to_words(mem + hdr_size, allocation._allocated_tlab_size - hdr_size, badHeapWordVal);
#endif // ASSERT
  }

  tlab.fill(mem, mem + _word_size, allocation._allocated_tlab_size);
  return mem;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>在tlab.free()&gt;tlab.refill_waste_limit()时，会调用record_slow_allocation调整refill_waste_limit并统计_slow_acclocations，
每次slow allocation（即tlab无法分配新对象的空间且free &gt; refill_waste_limit），则给refill_waste_limit加上refill_waste_limit_increment。
避免TLAB出现卡在这里一直走out of TLAB的情况。</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>void ThreadLocalAllocBuffer::record_slow_allocation(size_t obj_size) {
  // Raise size required to bypass TLAB next time. Why? Else there's
  // a risk that a thread that repeatedly allocates objects of one
  // size will get stuck on this slow path.

  set_refill_waste_limit(refill_waste_limit() + refill_waste_limit_increment());

  _slow_allocations++;

  log_develop_trace(gc, tlab)(&quot;TLAB: %s thread: &quot; INTPTR_FORMAT &quot; [id: %2d]&quot;
                              &quot; obj: &quot; SIZE_FORMAT
                              &quot; free: &quot; SIZE_FORMAT
                              &quot; waste: &quot; SIZE_FORMAT,
                              &quot;slow&quot;, p2i(thread()), thread()-&gt;osthread()-&gt;thread_id(),
                              obj_size, free(), refill_waste_limit());
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>allocate_inside_tlab返回为NULL的时候，会调用allocate_outside_tlab在tlab之外分配内存。</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>HeapWord* MemAllocator::mem_allocate(Allocation&amp;amp; allocation) const {
  if (UseTLAB) {
    HeapWord* result = allocate_inside_tlab(allocation);
    if (result != NULL) {
      return result;
    }
  }

  return allocate_outside_tlab(allocation);
}

HeapWord* MemAllocator::allocate_outside_tlab(Allocation&amp;amp; allocation) const {
  allocation._allocated_outside_tlab = true;
  HeapWord* mem = Universe::heap()-&gt;mem_allocate(_word_size, &amp;amp;allocation._overhead_limit_exceeded);
  if (mem == NULL) {
    return mem;
  }

  NOT_PRODUCT(Universe::heap()-&gt;check_for_non_bad_heap_word_value(mem, _word_size));
  size_t size_in_bytes = _word_size * HeapWordSize;
  _thread-&gt;incr_allocated_bytes(size_in_bytes);

  return mem;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>mem_allocate方法是在堆内存中分配内存的方法，对于g1的实现在G1CollectedHeap.cpp中，会先判断是否是Humongous巨型对象，
如果是进行巨型对象分配，巨型对象单独占用若干块连续region</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>HeapWord*
G1CollectedHeap::mem_allocate(size_t word_size,
                              bool*  gc_overhead_limit_was_exceeded) {
  assert_heap_not_locked_and_not_at_safepoint();

  if (is_humongous(word_size)) {
    return attempt_allocation_humongous(word_size);
  }
  size_t dummy = 0;
  return attempt_allocation(word_size, word_size, &amp;amp;dummy);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>普通对象的分配，最终会调用到heapRegion.inline.hpp中，par_allocate_impl方法中会通过cas top指针的方式分配内存。</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>inline HeapWord* HeapRegion::par_allocate_impl(size_t min_word_size,
                                               size_t desired_word_size,
                                               size_t* actual_size) {
  do {
    HeapWord* obj = top();
    size_t available = pointer_delta(end(), obj);
    size_t want_to_allocate = MIN2(available, desired_word_size);
    if (want_to_allocate &gt;= min_word_size) {
      HeapWord* new_top = obj + want_to_allocate;
      HeapWord* result = Atomic::cmpxchg(&amp;amp;_top, obj, new_top);
      // result can be one of two:
      //  the old top value: the exchange succeeded
      //  otherwise: the new value of the top is returned.
      if (result == obj) {
        assert(is_object_aligned(obj) &amp;amp;&amp;amp; is_object_aligned(new_top), &quot;checking alignment&quot;);
        *actual_size = want_to_allocate;
        return obj;
      }
    } else {
      return NULL;
    }
  } while (true);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="关于tlab的大小size的计算"><a href="#关于tlab的大小size的计算" class="header-anchor">#</a> 关于TLAB的大小size的计算</h3> <p>TLAB可以理解为线程每次从eden中获取的批量内存大小。为了在内存利用率和n</p> <h3 id="tlab结构定义"><a href="#tlab结构定义" class="header-anchor">#</a> TLAB结构定义</h3> <p>_start: 当前TLAB的地址起始位置
_top: 当前内存分配已经使用到的地方
_pf_top: prefetch watermark
_end: 当前TLAB的地址结束位置
_allocation_end: 当前TLAB的地址结束位置
_desired_size: 目标大小
_refill_waste_limit: refill时waste的limit
_allocated_before_last_gc:
_bytes_since_last_sample_point:</p> <p>_max_size: TLAB的最大大小
_reserve_for_allocation_prefetch:
_target_refills:</p> <p>_number_of_refills:
_refill_waste:
_gc_waste:
_slow_allocations:
_allocated_size:
_allocation_fraction: 在eden分配内存时，分配中TLAB中的比例</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>class ThreadLocalAllocBuffer: public CHeapObj&amp;lt;mtThread&gt; {
  friend class VMStructs;
  friend class JVMCIVMStructs;
private:
  HeapWord* _start;                              // address of TLAB
  HeapWord* _top;                                // address after last allocation
  HeapWord* _pf_top;                             // allocation prefetch watermark
  HeapWord* _end;                                // allocation end (can be the sampling end point or _allocation_end)
  HeapWord* _allocation_end;                     // end for allocations (actual TLAB end, excluding alignment_reserve)

  size_t    _desired_size;                       // desired size   (including alignment_reserve)
  size_t    _refill_waste_limit;                 // hold onto tlab if free() is larger than this
  size_t    _allocated_before_last_gc;           // total bytes allocated up until the last gc
  size_t    _bytes_since_last_sample_point;      // bytes since last sample point.

  static size_t   _max_size;                          // maximum size of any TLAB
  static int      _reserve_for_allocation_prefetch;   // Reserve at the end of the TLAB
  static unsigned _target_refills;                    // expected number of refills between GCs

  unsigned  _number_of_refills;
  unsigned  _refill_waste;
  unsigned  _gc_waste;
  unsigned  _slow_allocations;
  size_t    _allocated_size;

  AdaptiveWeightedAverage _allocation_fraction;  // fraction of eden allocated in tlabs

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="init-size"><a href="#init-size" class="header-anchor">#</a> init size</h3> <h3 id="max-size"><a href="#max-size" class="header-anchor">#</a> max size</h3> <h3 id="resize"><a href="#resize" class="header-anchor">#</a> resize</h3> <h3 id="tlab-log查看"><a href="#tlab-log查看" class="header-anchor">#</a> TLAB log查看</h3> <h3 id="通过jfr监控tlab"><a href="#通过jfr监控tlab" class="header-anchor">#</a> 通过JFR监控TLAB</h3> <h3 id="通过perf监控tlab"><a href="#通过perf监控tlab" class="header-anchor">#</a> 通过perf监控TLAB</h3> <h2 id="plab"><a href="#plab" class="header-anchor">#</a> PLAB</h2> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <h2 id="其他参考"><a href="#其他参考" class="header-anchor">#</a> 其他参考</h2></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/liuzhengyang/liuzhengyang.github.io/edit/master/docs/md/jvm/jvm/tlab.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/md/jvm/jvm/string-deduplication.html" class="prev">
          String Deduplication
        </a></span> <span class="next"><a href="/md/jvm/jvm/synchronizer.html">
          synchronzier
        </a>
        →
      </span></p></div> </main></div> <aside class="page-sidebar"> <div class="page-side-toolbar"><div class="option-box-toc-fixed"><div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:650px"><div style="font-weight:bold;text-align:center;">TLAB</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/md/jvm/jvm/tlab.html#tlab的配置" class="toc-sidebar-link">TLAB的配置</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/jvm/jvm/tlab.html#tlab的实现" class="toc-sidebar-link">TLAB的实现</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#usetlab" class="toc-sidebar-link">UseTLAB</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#resizetlab" class="toc-sidebar-link">ResizeTLAB</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#mintlabsize" class="toc-sidebar-link">MinTLABSize</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#tlabsize" class="toc-sidebar-link">TLABSize</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#关键概念、流程" class="toc-sidebar-link">关键概念、流程</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#关于tlab的大小size的计算" class="toc-sidebar-link">关于TLAB的大小size的计算</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#tlab结构定义" class="toc-sidebar-link">TLAB结构定义</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#init-size" class="toc-sidebar-link">init size</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#max-size" class="toc-sidebar-link">max size</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#resize" class="toc-sidebar-link">resize</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#tlab-log查看" class="toc-sidebar-link">TLAB log查看</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#通过jfr监控tlab" class="toc-sidebar-link">通过JFR监控TLAB</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#通过perf监控tlab" class="toc-sidebar-link">通过perf监控TLAB</a></li></ul></li><li><a href="/md/jvm/jvm/tlab.html#plab" class="toc-sidebar-link">PLAB</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/jvm/jvm/tlab.html#总结" class="toc-sidebar-link">总结</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/jvm/jvm/tlab.html#其他参考" class="toc-sidebar-link">其他参考</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box-toc-over"><img src="/images/system/toc.png" class="nozoom"> <span class="show-txt">目录</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:550px"><div style="font-weight:bold;text-align:center;">TLAB</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/md/jvm/jvm/tlab.html#tlab的配置" class="toc-sidebar-link">TLAB的配置</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/jvm/jvm/tlab.html#tlab的实现" class="toc-sidebar-link">TLAB的实现</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#usetlab" class="toc-sidebar-link">UseTLAB</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#resizetlab" class="toc-sidebar-link">ResizeTLAB</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#mintlabsize" class="toc-sidebar-link">MinTLABSize</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#tlabsize" class="toc-sidebar-link">TLABSize</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#关键概念、流程" class="toc-sidebar-link">关键概念、流程</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#关于tlab的大小size的计算" class="toc-sidebar-link">关于TLAB的大小size的计算</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#tlab结构定义" class="toc-sidebar-link">TLAB结构定义</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#init-size" class="toc-sidebar-link">init size</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#max-size" class="toc-sidebar-link">max size</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#resize" class="toc-sidebar-link">resize</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#tlab-log查看" class="toc-sidebar-link">TLAB log查看</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#通过jfr监控tlab" class="toc-sidebar-link">通过JFR监控TLAB</a></li><li class="toc-sidebar-sub-header"><a href="/md/jvm/jvm/tlab.html#通过perf监控tlab" class="toc-sidebar-link">通过perf监控TLAB</a></li></ul></li><li><a href="/md/jvm/jvm/tlab.html#plab" class="toc-sidebar-link">PLAB</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/jvm/jvm/tlab.html#总结" class="toc-sidebar-link">总结</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/jvm/jvm/tlab.html#其他参考" class="toc-sidebar-link">其他参考</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box"><img src="/images/system/wechat.png" class="nozoom"> <span class="show-txt">手机看</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.9rem">微信扫一扫</span> <img height="180px" src="https://api.qrserver.com/v1/create-qr-code/?data=https://bytejava.cn/md/jvm/jvm/tlab.html" style="margin:10px;">
                可以<b>手机看</b>或分享至<b>朋友圈</b></div></div></div></div> <div class="option-box"><img src="/images/personal/wechat-mp-logo.jpg" height="20" class="nozoom"> <span class="show-txt">公众号</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.9rem">关注公众号bytejava</span> <img src="/images/personal/wechat-mp.png" height="180" width></div></div></div></div> <div class="option-box"><img src="/images/system/toggle.png" width="30px" class="nozoom"> <span class="show-txt">左栏</span></div> <div class="option-box"><img src="/images/system/heart-1.png" width="25px" class="nozoom"> <span class="show-txt">赞赏我</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.8rem;font-weight:bold;">鼓励/支持/赞赏我</span> <img height="180px" src="/images/personal/encourage-head.jpg" style="margin:5px;"> <br>1. 不靠它生存但仍希望得到你的鼓励；
                <br>2. 时刻警醒自己保持技术人的初心，沉淀，分享，成长；
              </div></div></div></div> <div title="String Deduplication" class="option-box" style="padding-left:2px;text-align:center;"><a href="/md/jvm/jvm/string-deduplication.html"><img src="/images/system/pre2.png" width="30px" class="nozoom"> <span class="show-txt">上一篇</span></a></div> <div title="synchronzier" class="option-box" style="padding-left:2px;text-align:center;"><a href="/md/jvm/jvm/synchronizer.html"><img src="/images/system/next2.png" width="30px" class="nozoom"> <span class="show-txt">下一篇</span></a></div></div>  <!----> </aside></div><div class="global-ui"></div></div>
    <script src="/assets/js/cg-styles.js?v=1729221831211" defer></script><script src="/assets/js/cg-4.js?v=1729221831211" defer></script><script src="/assets/js/cg-3.js?v=1729221831211" defer></script><script src="/assets/js/cg-220.js?v=1729221831211" defer></script><script src="/assets/js/cg-app.js?v=1729221831211" defer></script>
  </body>
</html>
